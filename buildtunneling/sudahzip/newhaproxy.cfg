global
  tune.ssl.default-dh-param 2048

defaults 
    timeout connect 24h
    timeout client 24h
    timeout server 24h    

frontend tunel
  mode tcp
  bind *:443 ssl crt /libc64/module.pem alpn h2,h2c,http/1.1
  bind *:80 alpn h2,h2c,http/1.1
  tcp-request inspect-delay 3s
  tcp-request content accept if { req.ssl_hello_type 1 }
  option forwardfor header X-Real-IP
  http-request set-header X-Real-IP %[src]
  acl this_payload payload(0,7) -m bin 5353482d322e30
  acl path_read path -i /vmess
  acl path_read path -i /vless
  acl path_read path -i /none
  acl path_read path -i /vnone
  acl path_read path -i /trojan
  acl path_read path -i /xrayvm
  acl path_read path -i /xrayvl
  acl path_read path -i /xrayvmno
  acl path_read path -i /xrayvlno
  acl methoded method GET HEAD
  use_backend payload_data if this_payload
  use_backend path_data if path_read
  use_backend p0t4t0 if { ssl_fc_alpn -i h2 }
  use_backend get_Connect if methoded
  use_backend no_Length if !{ req.len 0 }
  
backend get_Connect
  mode tcp
  server localhost 127.0.0.1:333 send-proxy check

backend path_data
  mode tcp
  option forwardfor header X-Real-IP
  http-request set-header X-Real-IP %[src]
  server localhost 127.0.0.1:222 send-proxy check

backend p0t4t0
  mode tcp
  option forwardfor header X-Real-IP
  http-request set-header X-Real-IP %[src]
  server localhost 127.0.0.1:223 send-proxy check

backend no_Length
  mode tcp
  server localhost 127.0.0.1:1194

backend payload_data
  mode tcp
  server localhost-bitbucket-ssh 127.0.0.1:444